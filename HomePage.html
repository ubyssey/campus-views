<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://storage.googleapis.com/vrview/2.0/build/vrview.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>
<body>
  <div class="wrapper">
    <div id="header">
      <div id="header-content">
          <h1>Views of UBC - <a href="https://www.ubyssey.ca/">The Ubyssey</a></h1>
      </div>
    </div>
    <div id="Pictures">
      <div id="vrview"> </div>
      <div class="gallery-container">
        <div class="Gallery">
          <ul class="carousel"></ul>
        </div>
      </div>
    </div>
  </div>

<style>
  html, body {
    height: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  .wrapper {
    max-width: 100%;
    height: 100%;
    overflow: hidden;
  }

  body {
    background-color: dimgray;
    color: whitesmoke;
    margin: 0;
  }

  * {
    font-family: "lft-etica";
  }

  @font-face {
    font-family: "left-etica";
    src: url(lft_etica_book-webfont.woff);
  }

  #header {
    background-color: black;
    /*Opacity start*/
    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";
    filter: alpha(opacity=80);
    -moz-opacity: 0.80;
    -khtml-opacity: 0.8;
    opacity: 0.8;
    /*Opacity end*/
    color: white;
    position: fixed;
    z-index: 20;
    top: 0;
    left: 0;
    width: 100%;
    height: 40px;
    padding: 0;
    margin: 0;
  }
  h1 {
    margin-top: 5px;
  }
  a {
    color: #0071c9;
  }

  #header #header-content {
      text-align: center;
      font-size: 10px;
      margin-top: 0;
  }

  .Gallery {
    position: absolute;
    margin-left: auto;
    margin-right: auto;
    left: 0;
    right: 0;
    text-align: center;
    bottom: 45px;
  }

  .Gallery ul {
    display: inline-flex;
  }

  .carousel {
    flex-direction: row;
    margin: 0;
    padding: 0;
    height: 100px;
    transition: margin-left 0.5s;
  }

  ul.carousel {
    list-style-type: none;
  }

  ul.img {
    display: inline-block;
  }

  ul.carousel li {
    position: relative;
    width: 150px;
    height: 100px;
    margin-right: 16px;
  }

  ul.carousel li img {
    width: 100%;
    height: 100%;

    border-radius: 2px;

    cursor: pointer;

    box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
  }

  #Pictures {
    position: fixed;
    z-index: 10;
    height: 100%;
    width: 100%;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  #vrview {
    flex: 1;
    height: 100%;
  }

  #vrview iframe {
    height: 100%;
    display: block;
  }

  .gallery-container {
    max-width: 100%;
    overflow: hidden;
  }

/* Tooltip container */
  .tooltip {
      position: relative;
      display: inline-block;
      border-bottom: 1px;
      margin-bottom: 3px;
  }

  /* Tooltip text */
  .tooltiptext {
    visibility: hidden;
    width: 120px;
    bottom: 110px;
    left: 50%;
    margin-left: -60px; /* Use half of the width (120/2 = 60), to center the tooltip */
    background-color: black;
    color: #fff;
    text-align: center;
    padding: 5px 0;
    border-radius: 6px;

    /* Position the tooltip text */
    position: absolute;
    z-index: 1;
  }

  /* Show the tooltip text when you mouse over the tooltip container */
  ul.carousel li:hover .tooltiptext,
  ul.carousel li.current .tooltiptext {
    visibility: visible;
  }
</style>

<script>
//Google VR API script to swap out photos
var vrView;
var browserHeight = $(window).height();
var carouselHeight = $('.carousel').height();
var thumbnailWidth = 150 + 16;

// All the scenes for the experience
var scenes = [
  {
    title: 'Marine Drive',
    image: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/MarineDrive.jpg',
    thumbnail: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/MarineDriveTumbnail.png'
  },
  {
    title: 'Mosquito Field',
    image: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/Mosquito_Field.jpg',
    thumbnail: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/MosqFeildThumbnail.png'
  },
  {
    title: 'Museum of Anthropology',
    image: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/MOA.jpg',
    thumbnail: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/MOAThumbnail.png'
  },
  {
    title: 'Wreck Beach',
    image: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/WreckBeach.jpg',
    thumbnail: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/WreckBeachThumbnail.png'
  },
  {
    title: 'AMS Nest',
    image: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/Nest.jpg',
    thumbnail: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/NestThumbnail.png'
  },
  {
    title: 'Nitobe Garden',
    image: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/Nitobe.jpg',
    thumbnail: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/NitobeThumbnail.png'
  },
  {
    title: 'Tower Beach Stairs',
    image: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/TowerBeachStairs.jpg',
    thumbnail: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/TowerBeachThumbnail.png'
  }
];

var activeScene = 0;

function renderCarousel() {

  var carousel = $('.carousel');

  scenes.forEach(function(scene, i) {

    var item = $('<li></li>');

    var image = $('<img />');
    image.attr('src', scene.thumbnail);

    var tooltip = $('<span></span>');
    tooltip.addClass('tooltiptext');
    tooltip.text(scene.title);

    item.append(image);
    item.append(tooltip);

    item.data('i', i);

    if (activeScene == i) {
      item.addClass('current');
    }

    carousel.append(item);

  });

  console.log(carousel);

}

function onLoad() {
  vrView = new VRView.Player('#vrview', {
    width: '100%',
    height: browserHeight,
    image: 'https://raw.githubusercontent.com/ubyssey/campus-views/master/VR_Photos/MarineDrive.jpg',
    is_stereo: false,
    is_autopan_off: true
  });

  vrView.on('ready', onVRViewReady);
  vrView.on('modechange', onModeChange);
  vrView.on('error', onVRViewError);
}

function loadScene(id) {
  console.log('loadScene', id);

  // Set the image
vrView.setContent({
    image: scenes[id].image,
    //preview: scenes[id].preview,
    is_autopan_off: true
  });
}

function mobileResize() {
  var windowWidth = $(window).width();
  if(windowWidth < 800){
    var carouselOffset = (thumbnailWidth * activeScene) + (thumbnailWidth / 2);
    $('ul.carousel').css('margin-left', -carouselOffset);
    $('.Gallery').css('left', '50%');
    $(document).on('click', 'ul.carousel li', function(e) {
      $('.Gallery').css('left', '50%');
      e.preventDefault();
      var i = $(this).data('i');
      activeScene = i;
      loadScene(i);
      var carouselOffset = (thumbnailWidth * i) + (thumbnailWidth / 2);
      $('ul.carousel').css('margin-left', -carouselOffset);
      $('ul.carousel li').removeClass('current');
      $(this).addClass('current');
    });
  }
  else {
    $('.Gallery').css('text-align', 'center');
    $('ul.carousel').css('text-align', 'center');
    $('ul.carousel li').css('display', 'inline-block');
    $(document).on('click', 'ul.carousel li', function(e) {
      e.preventDefault();
      var i = $(this).data('i');
      activeScene = i;
      loadScene(i);
      $('ul.carousel li').removeClass('current');
      $(this).addClass('current');
    });
  }
}

function onVRViewReady(e) {
  console.log('onVRViewReady');
  mobileResize();
}

function onModeChange(e) {
  console.log('onModeChange', e.mode);
}

function onVRViewError(e) {
  console.log('Error! %s', e.message);
}

window.addEventListener('load', onLoad);

$(function () {
  renderCarousel();
    $( window ).resize(function() {
      browserHeight = $(window).height();
      carouselHeight = $('.carousel').height();
      $( "#vrview" ).css( {width: '100%',
      height: browserHeight});
      mobileResize();
    });
});
</script>

</body>
</html>
